<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Student Collaboration Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .notifications-dropdown {
            z-index: 50;
        }
        .user-dropdown {
            z-index: 50;
        }
        .modal {
            z-index: 100;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hackathon-card {
            min-width: 300px;
            transition: all 0.3s ease;
        }
        .hackathon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Enhanced Chatbot Styles */
        .dashboard-chatbot {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: transform 0.3s ease;
            cursor: default;
            transform: translate(0, 0);
        }
        .dashboard-chatbot.collapsed {
            transform: translateX(330px) !important;
        }
        .chatbot-header {
            padding: 12px 16px;
            background: #4F46E5;
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
        }
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .chatbot-input {
            padding: 12px;
            border-top: 1px solid #E5E7EB;
        }
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-line;
        }
        .message.user {
            align-self: flex-end;
            background: #4F46E5;
            color: white;
            border-radius: 12px 12px 0 12px;
        }
        .message.bot {
            align-self: flex-start;
            background: #F3F4F6;
            color: #1F2937;
            border-radius: 12px 12px 12px 0;
        }
        .chatbot-toggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: #4F46E5;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1001;
        }
        .chatbot-toggle:hover {
            transform: scale(1.1);
            background: #4338CA;
        }
        .chatbot-toggle.hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm relative z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <!-- Left side - Logo and Main Links -->
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="text-3xl font-bold text-primary-600">CodeSpace</a>
                    </div>
                    <div class="hidden sm:ml-8 sm:flex sm:space-x-8">
                        <a href="/dashboard.html" class="border-primary-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-base font-medium">
                            Dashboard
                        </a>
                        <a href="/projects.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-base font-medium">
                            All Projects
                        </a>
                        <a href="/profile.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-base font-medium">
                            Profile
                        </a>
                    </div>
                </div>

                <!-- Right side - Notifications and User Menu -->
                <div class="flex items-center space-x-6">
                    <!-- Search Bar -->
                    <div class="hidden md:block">
                        <div class="relative">
                            <input type="text" placeholder="Search projects..." class="w-72 px-4 py-2.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Dropdown -->
                    <div class="relative">
                        <button id="notificationsBtn" class="p-2.5 text-gray-600 hover:text-gray-900 relative">
                            <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span id="notificationCount" class="absolute top-0 right-0 block h-5 w-5 rounded-full bg-red-500 text-white text-xs flex items-center justify-center">0</span>
                        </button>
                        <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 notifications-dropdown">
                            <div class="py-1">
                                <div class="px-4 py-2 border-b border-gray-200">
                                    <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                                </div>
                                <div id="notificationsList" class="max-h-96 overflow-y-auto">
                                    <!-- Notifications will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Menu -->
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center text-gray-600 hover:text-gray-900">
                            <div class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                                <span class="text-primary-600 font-medium text-lg" id="userInitials"></span>
                            </div>
                            <span id="userName" class="ml-3 text-base font-medium"></span>
                            <svg class="ml-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 user-dropdown">
                            <div class="py-1">
                                <a href="/profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" id="logoutButton" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
            <div class="flex space-x-4">
                <a href="/projects.html" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    View All Projects
                </a>
                <button id="createProjectBtn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create New Project
                </button>
            </div>
        </div>

        <!-- Create Project Modal -->
        <div id="createProjectModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full modal">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Project</h3>
                    <form id="createProjectForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Title</label>
                            <input type="text" id="projectTitle" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="projectDescription" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tech Stack (comma-separated)</label>
                            <input type="text" id="projectTechStack" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Looking For (comma-separated)</label>
                            <input type="text" id="projectLookingFor" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">GitHub Link (optional)</label>
                            <input type="url" id="projectGithubLink" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancelCreateProject" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700">
                                Create Project
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="bg-white shadow rounded-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-900">My Projects</h2>
            </div>
            <div id="projectsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Projects will be populated here -->
            </div>
        </div>

        <!-- Collaborated Projects Section -->
        <div class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Collaborated Projects</h2>
            <div id="collaboratedProjectsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Collaborated projects will be populated here -->
            </div>
        </div>

        <!-- Hackathon Teams Section -->
        <div class="bg-white shadow rounded-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-900">My Hackathon Teams</h2>
                <div class="flex space-x-4">
                    <button onclick="resetJoinRequests()" 
                            class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">
                        Reset Join Requests
                    </button>
                    <button id="createHackathonTeamBtn" class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Register Team for Hackathon
                    </button>
                </div>
            </div>
            <div id="hackathonTeamsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Hackathon teams will be populated here -->
            </div>
        </div>

        <!-- Teams I'm In Section -->
        <div class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Teams I'm In</h2>
            <div id="teamsImInList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Teams I'm in will be populated here -->
            </div>
        </div>

        <!-- All Upcoming Hackathons Section -->
        <div class="bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Listed Hackathon Teams : Join Now !</h2>
            <div class="relative">
                <div id="allHackathonsList" class="flex overflow-x-auto pb-4 space-x-6 scrollbar-hide">
                    <!-- All hackathons will be populated here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Dashboard Chatbot -->
        <div class="dashboard-chatbot collapsed">
            <div class="chatbot-header">
                <span class="font-medium">Dashboard Assistant</span>
                <button id="toggleChatbot" class="text-white hover:text-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message bot">
                    Hello! I'm your dashboard assistant. I can help you with:
                    - Viewing project details
                    - Checking collaborators
                    - Explore email of owner for collaborated projects
                    - Viewing team members
                    - Accessing collaborator profiles
                    How can I help you today?
                </div>
            </div>
            <div class="chatbot-input">
                <div class="flex space-x-2">
                    <input type="text" id="chatbotInput" placeholder="Type your message..." 
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <button id="sendMessage" class="px-4 py-2 text-white bg-primary-600 rounded-md hover:bg-primary-700">
                        Send
                    </button>
                </div>
            </div>
        </div>
        <div class="chatbot-toggle" id="chatbotToggle">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Platform Info -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">CodeSpace</h3>
                    <p class="text-sm text-gray-500">Connecting students to collaborate on innovative projects and build their portfolio.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">GitHub</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.91-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">LinkedIn</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-.88-.06-1.601-1-1.601-1 0-1.16.781-1.16 1.601v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" clip-rule="evenodd"></path>
                            </svg>
                        </a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase">Quick Links</h3>
                    <ul class="mt-4 space-y-4">
                        <li>
                            <a href="/dashboard.html" class="text-base text-gray-500 hover:text-gray-900">Dashboard</a>
                        </li>
                        <li>
                            <a href="/projects.html" class="text-base text-gray-500 hover:text-gray-900">All Projects</a>
                        </li>
                        <li>
                            <a href="/profile.html" class="text-base text-gray-500 hover:text-gray-900">Profile</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Create Project</a>
                        </li>
                    </ul>
                </div>

                <!-- Resources -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase">Resources</h3>
                    <ul class="mt-4 space-y-4">
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Getting Started</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Best Practices</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">FAQ</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Support</a>
                        </li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase">Legal</h3>
                    <ul class="mt-4 space-y-4">
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Privacy Policy</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Terms of Service</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Cookie Policy</a>
                        </li>
                        <li>
                            <a href="#" class="text-base text-gray-500 hover:text-gray-900">Contact Us</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="mt-12 border-t border-gray-200 pt-8">
                <p class="text-base text-gray-400 text-center">
                    &copy; 2024 Codespace. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <!-- Create Hackathon Team Modal -->
    <div id="createHackathonTeamModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Register Team for Hackathon</h3>
                <form id="createHackathonTeamForm" class="space-y-4">
                    <div>
                        <label for="hackathonName" class="block text-sm font-medium text-gray-700">Hackathon Name</label>
                        <input type="text" id="hackathonName" name="hackathonName" required
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label for="teamName" class="block text-sm font-medium text-gray-700">Team Name</label>
                        <input type="text" id="teamName" name="teamName" required
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label for="teamSize" class="block text-sm font-medium text-gray-700">Team Size</label>
                        <input type="number" id="teamSize" name="teamSize" required min="1"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label for="vacantPositions" class="block text-sm font-medium text-gray-700">Vacant Positions (comma-separated)</label>
                        <input type="text" id="vacantPositions" name="vacantPositions" required
                            placeholder="e.g., Backend Developer, Frontend Developer"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label for="requiredTechStack" class="block text-sm font-medium text-gray-700">Required Tech Stack (comma-separated)</label>
                        <input type="text" id="requiredTechStack" name="requiredTechStack" required
                            placeholder="e.g., Node.js, React, MongoDB"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label for="specificRequirements" class="block text-sm font-medium text-gray-700">Specific Requirements</label>
                        <textarea id="specificRequirements" name="specificRequirements" rows="3"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelCreateHackathonTeam"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700">
                            Create Team
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadUserProjects();
            loadCollaboratedProjects();
            loadHackathonTeams();
            loadTeamsImIn();
            loadAllHackathons();
            loadNotifications();
            initializeDashboardChatbot();
        });

        const API_URL = 'https://codespace-4bbx.onrender.com/api';
        let currentUserId = null;

        // Check authentication status
        async function checkAuth() {
            try {
                const response = await fetch('https://codespace-4bbx.onrender.com/api/auth/status', {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Authentication failed');
                }
                
                const data = await response.json();
                
                if (data.isAuthenticated && data.user) {
                    const user = data.user;
                    localStorage.setItem('user', JSON.stringify(user));
                    
                    // Update UI for authenticated user
                    const authButtons = document.getElementById('auth-buttons');
                    const userMenu = document.getElementById('user-menu');
                    const userName = document.getElementById('user-name');
                    const userInitials = document.getElementById('user-initials');
                    
                    if (authButtons) authButtons.style.display = 'none';
                    if (userMenu) userMenu.style.display = 'block';
                    if (userName) userName.textContent = user.name || user.email;
                    if (userInitials) {
                        const initials = (user.name || user.email)
                            .split(' ')
                            .map(n => n[0])
                            .join('')
                            .toUpperCase();
                        userInitials.textContent = initials;
                    }
                    
                    return true;
                } else {
                    localStorage.removeItem('user');
                    window.location.href = '/';
                    return false;
                }
            } catch (error) {
                console.error('Auth check error:', error);
                localStorage.removeItem('user');
                window.location.href = '/';
                return false;
            }
        }

        // Load user projects
        async function loadUserProjects() {
            try {
                const response = await fetch('https://codespace-4bbx.onrender.com/api/projects/user', {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error response:', errorData);
                    throw new Error(errorData.message || 'Failed to load projects');
                }
                
                const projects = await response.json();
                console.log('Loaded projects:', projects);
                
                const projectsContainer = document.getElementById('projectsList');
                
                if (!projects || projects.length === 0) {
                    projectsContainer.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">No projects</h3>
                            <p class="mt-1 text-sm text-gray-500">Get started by creating a new project.</p>
                            <div class="mt-6">
                                <button onclick="document.getElementById('createProjectBtn').click()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    Create New Project
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                projectsContainer.innerHTML = projects.map(project => `
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${project.title}</h3>
                        <p class="text-gray-600 mb-4">${project.description}</p>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Tech Stack:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${project.techStack.map(tech => `
                                    <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${tech}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Looking For:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${project.lookingFor.map(role => `
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${role}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <a href="/project.html?id=${project._id}" class="text-blue-600 hover:text-blue-700">View Details</a>
                            <div class="space-x-2">
                                <button onclick="editProject('${project._id}')" class="text-gray-600 hover:text-gray-900">Edit</button>
                                <button onclick="deleteProject('${project._id}')" class="text-red-600 hover:text-red-700">Delete</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
                const projectsContainer = document.getElementById('projectsList');
                projectsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-500">Error loading projects. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Load notifications
        async function loadNotifications() {
            try {
                const response = await fetch(`${API_URL}/notifications`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                const container = document.getElementById('notificationsList');
                const countElement = document.getElementById('notificationCount');
                
                // Update notification count
                const unreadCount = data.filter(n => !n.read).length;
                countElement.textContent = unreadCount;
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<p class="px-4 py-2 text-gray-500">No notifications</p>';
                    return;
                }
                
                container.innerHTML = data.map(notification => {
                    let actionButtons = '';
                    
                    // Add approve/reject buttons for join requests
                    if (notification.type === 'hackathon_join_request') {
                        actionButtons = `
                            <div class="flex space-x-2 mt-2">
                                <button onclick="handleJoinRequest('${notification.team}', '${notification.fromUser._id}', 'accept')" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    Accept
                                </button>
                                <button onclick="handleJoinRequest('${notification.team}', '${notification.fromUser._id}', 'reject')" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    Reject
                                </button>
                            </div>
                        `;
                    }
                    
                    // Add approve/reject buttons for collaboration requests
                    if (notification.type === 'collaboration_request' && !notification.read) {
                        actionButtons = `
                            <div class="flex space-x-2 mt-2">
                                <button onclick="handleCollaborationRequest('${notification.project._id}', '${notification.fromUser._id}', 'accept')" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    Accept
                                </button>
                                <button onclick="handleCollaborationRequest('${notification.project._id}', '${notification.fromUser._id}', 'reject')" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    Reject
                                </button>
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="bg-white p-4 rounded-lg shadow mb-4 ${!notification.read ? 'border-l-4 border-blue-500' : ''}">
                            <div class="flex flex-col">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="text-gray-800">${notification.message}</p>
                                        <p class="text-sm text-gray-500 mt-1">${new Date(notification.createdAt).toLocaleString()}</p>
                                    </div>
                                </div>
                                ${actionButtons}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading notifications:', error);
                const container = document.getElementById('notificationsList');
                container.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-red-500">Error loading notifications. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Handle join request (accept/reject)
        async function handleJoinRequest(teamId, userId, action) {
            try {
                console.log('Handling join request:', { teamId, userId, action });
                if (!teamId) {
                    throw new Error('Team ID is required');
                }
                
                const response = await fetch(`${API_URL}/hackathon-teams/${teamId}/handle-request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId,
                        action
                    }),
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Handle request response:', data);
                
                // Refresh notifications and teams
                loadNotifications();
                loadTeamsImIn();
                loadAllHackathons();
                
                alert(action === 'accept' ? 'Join request accepted!' : 'Join request rejected.');
            } catch (error) {
                console.error('Error handling join request:', error);
                alert(error.message || 'Error handling join request');
            }
        }

        // Create project form submission
        document.getElementById('createProjectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const projectData = {
                title: document.getElementById('projectTitle').value,
                description: document.getElementById('projectDescription').value,
                techStack: document.getElementById('projectTechStack').value.split(',').map(tech => tech.trim()),
                lookingFor: document.getElementById('projectLookingFor').value.split(',').map(role => role.trim()),
                githubLink: document.getElementById('projectGithubLink').value
            };

            try {
                console.log('Submitting project data:', projectData);
                const response = await fetch(`${API_URL}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(projectData)
                });

                const data = await response.json();
                console.log('Server response:', data);

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to create project');
                }

                // Close modal and refresh projects
                document.getElementById('createProjectModal').classList.add('hidden');
                document.getElementById('createProjectForm').reset();
                loadUserProjects();
                
                // Show success message
                alert('Project created successfully!');
            } catch (error) {
                console.error('Error creating project:', error);
                alert(`Error creating project: ${error.message}`);
            }
        });

        // Modal handlers
        document.getElementById('createProjectBtn').addEventListener('click', () => {
            document.getElementById('createProjectModal').classList.remove('hidden');
        });

        document.getElementById('cancelCreateProject').addEventListener('click', () => {
            document.getElementById('createProjectModal').classList.add('hidden');
        });

        // Notifications dropdown handler
        document.getElementById('notificationsBtn').addEventListener('click', () => {
            const dropdown = document.getElementById('notificationsDropdown');
            dropdown.classList.toggle('hidden');
        });

        // User menu dropdown handler
        document.getElementById('userMenuButton').addEventListener('click', (e) => {
            e.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        });

        // Logout handler
        document.getElementById('logoutButton').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            const notificationsBtn = document.getElementById('notificationsBtn');
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const userMenuButton = document.getElementById('userMenuButton');
            const userDropdown = document.getElementById('userDropdown');

            if (!notificationsBtn.contains(e.target) && !notificationsDropdown.contains(e.target)) {
                notificationsDropdown.classList.add('hidden');
            }

            if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.classList.add('hidden');
            }
        });

        // Load hackathon teams
        async function loadHackathonTeams() {
            try {
                const response = await fetch(`${API_URL}/hackathon-teams/my-teams`, {
                    credentials: 'include'
                });
                const teams = await response.json();
                
                const teamsContainer = document.getElementById('hackathonTeamsList');
                
                if (!teams || teams.length === 0) {
                    teamsContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <p class="text-gray-500">You haven't registered any teams for hackathons yet.</p>
                            <button onclick="document.getElementById('createHackathonTeamBtn').click()" 
                                    class="mt-4 inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Register Team
                            </button>
                        </div>
                    `;
                    return;
                }
                
                teamsContainer.innerHTML = teams.map(team => `
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${team.teamName}</h3>
                        <p class="text-gray-600 mb-4">${team.hackathonName}</p>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Team Size:</h4>
                            <p class="text-gray-600">${team.currentSize}/${team.teamSize} members</p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Vacant Positions:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${team.vacantPositions.map(pos => `
                                    <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${pos.position}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Required Tech Stack:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${team.requiredTechStack.map(tech => `
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${tech}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <a href="/hackathon-team.html?id=${team._id}" class="text-green-600 hover:text-green-700">View Details</a>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading hackathon teams:', error);
                const teamsContainer = document.getElementById('hackathonTeamsList');
                teamsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-500">Error loading hackathon teams. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Load teams I'm in
        async function loadTeamsImIn() {
            try {
                const response = await fetch(`${API_URL}/hackathon-teams/teams-im-in`, {
                    credentials: 'include'
                });
                const teams = await response.json();
                
                const teamsContainer = document.getElementById('teamsImInList');
                
                if (!teams || teams.length === 0) {
                    teamsContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <p class="text-gray-500">You haven't joined any hackathon teams yet.</p>
                        </div>
                    `;
                    return;
                }
                
                teamsContainer.innerHTML = teams.map(team => {
                    const myMemberInfo = team.teamMembers.find(m => m.user && m.user._id === currentUserId);
                    const position = myMemberInfo ? myMemberInfo.position : 'Unknown Position';
                    
                    return `
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">${team.teamName}</h3>
                            <p class="text-gray-600 mb-4">${team.hackathonName}</p>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Team Lead:</h4>
                                <p class="text-gray-600">${team.owner.name}</p>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Your Position:</h4>
                                <p class="text-gray-600">${position}</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <a href="/hackathon-team.html?id=${team._id}" class="text-green-600 hover:text-green-700">View Details</a>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading teams I\'m in:', error);
                const teamsContainer = document.getElementById('teamsImInList');
                teamsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-500">Error loading teams. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Load all hackathons
        async function loadAllHackathons() {
            try {
                const response = await fetch(`${API_URL}/hackathon-teams`, {
                    credentials: 'include'
                });
                const teams = await response.json();
                
                const teamsContainer = document.getElementById('allHackathonsList');
                
                if (!teams || teams.length === 0) {
                    teamsContainer.innerHTML = `
                        <div class="min-w-full text-center py-8">
                            <p class="text-gray-500">No hackathon teams available at the moment.</p>
                        </div>
                    `;
                    return;
                }
                
                teamsContainer.innerHTML = teams.map(team => {
                    // Check if current user is the team owner
                    const isOwner = team.owner._id === currentUserId;
                    
                    return `
                        <div class="hackathon-card bg-white p-6 rounded-lg shadow flex-shrink-0">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">${team.teamName}</h3>
                            <p class="text-gray-600 mb-4">${team.hackathonName}</p>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Team Lead:</h4>
                                <p class="text-gray-600">${team.owner.name}</p>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Team Size:</h4>
                                <p class="text-gray-600">${team.currentSize}/${team.teamSize} members</p>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Vacant Positions:</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${team.vacantPositions.map(pos => `
                                        <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${pos.position}</span>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Required Tech Stack:</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${team.requiredTechStack.map(tech => `
                                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${tech}</span>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <a href="/hackathon-team.html?id=${team._id}" class="text-green-600 hover:text-green-700">View Details</a>
                                ${!isOwner ? `
                                    <button onclick="requestToJoinTeam('${team._id}')" 
                                            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700">
                                        Request to Join
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading all hackathons:', error);
                const teamsContainer = document.getElementById('allHackathonsList');
                teamsContainer.innerHTML = `
                    <div class="min-w-full text-center py-8">
                        <p class="text-red-500">Error loading hackathons. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Request to join team
        async function requestToJoinTeam(teamId) {
            try {
                console.log('Requesting to join team:', teamId);
                const position = prompt('Which position would you like to apply for?');
                if (!position) return;

                console.log('Sending request with position:', position);
                const requestData = { position };
                console.log('Request data:', requestData);

                const response = await fetch(`${API_URL}/hackathon-teams/${teamId}/join-request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestData)
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to send join request');
                }

                alert('Join request sent successfully!');
                loadNotifications(); // Refresh notifications
                loadAllHackathons(); // Refresh the hackathons list
            } catch (error) {
                console.error('Error requesting to join team:', error);
                alert(error.message || 'Error sending join request');
            }
        }

        // Create hackathon team form handler
        document.getElementById('createHackathonTeamForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                console.log('Submitting hackathon team form...');
                
                const formData = {
                    hackathonName: document.getElementById('hackathonName').value,
                    teamName: document.getElementById('teamName').value,
                    teamSize: parseInt(document.getElementById('teamSize').value),
                    vacantPositions: document.getElementById('vacantPositions').value.split(',').map(pos => ({
                        position: pos.trim(),
                        required: true
                    })),
                    requiredTechStack: document.getElementById('requiredTechStack').value.split(',').map(tech => tech.trim()),
                    specificRequirements: document.getElementById('specificRequirements').value
                };

                console.log('Form data:', formData);

                const response = await fetch(`${API_URL}/hackathon-teams`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                console.log('Server response:', data);
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to create team');
                }

                // Close modal and refresh teams
                document.getElementById('createHackathonTeamModal').classList.add('hidden');
                document.getElementById('createHackathonTeamForm').reset();
                loadHackathonTeams();
                loadAllHackathons();
                
                // Show success message
                alert('Team created successfully!');
            } catch (error) {
                console.error('Error creating hackathon team:', error);
                alert(error.message || 'Error creating team. Please try again.');
            }
        });

        // Modal handlers
        document.getElementById('createHackathonTeamBtn').addEventListener('click', () => {
            document.getElementById('createHackathonTeamModal').classList.remove('hidden');
        });

        document.getElementById('cancelCreateHackathonTeam').addEventListener('click', () => {
            document.getElementById('createHackathonTeamModal').classList.add('hidden');
        });

        // Add function to load collaborated projects
        async function loadCollaboratedProjects() {
            try {
                const response = await fetch('https://codespace-4bbx.onrender.com/api/projects/collaborations', {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load collaborated projects');
                }
                
                const projects = await response.json();
                const container = document.getElementById('collaboratedProjectsList');
                
                if (!projects || projects.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <p class="text-gray-500">You haven't collaborated on any projects yet.</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = projects.map(project => `
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${project.title}</h3>
                        <p class="text-gray-600 mb-4">${project.description}</p>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Tech Stack:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${project.techStack.map(tech => `
                                    <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${tech}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Looking For:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${project.lookingFor.map(role => `
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${role}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <a href="/project.html?id=${project._id}" class="text-blue-600 hover:text-blue-700">View Details</a>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading collaborated projects:', error);
                const container = document.getElementById('collaboratedProjectsList');
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-500">Error loading collaborated projects. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Reset join requests
        async function resetJoinRequests() {
            try {
                console.log('Resetting join requests...');
                const response = await fetch(`${API_URL}/hackathon-teams/reset-requests`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Reset response:', data);
                
                alert('Join requests have been reset successfully!');
                loadNotifications(); // Refresh notifications
                loadAllHackathons(); // Refresh the hackathons list
            } catch (error) {
                console.error('Error resetting join requests:', error);
                alert(error.message || 'Error resetting join requests');
            }
        }

        // Handle collaboration request (accept/reject)
        async function handleCollaborationRequest(projectId, userId, action) {
            try {
                const response = await fetch(`${API_URL}/projects/handle-collaboration-request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectId,
                        userId,
                        action
                    }),
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Handle collaboration request response:', data);
                
                // Refresh notifications and collaborated projects
                loadNotifications();
                loadCollaboratedProjects();
                
                alert(action === 'accept' ? 'Collaboration request accepted!' : 'Collaboration request rejected.');
            } catch (error) {
                console.error('Error handling collaboration request:', error);
                alert(error.message || 'Error handling collaboration request');
            }
        }

        // Enhanced Dashboard Chatbot Implementation
        function initializeDashboardChatbot() {
            const chatbot = document.querySelector('.dashboard-chatbot');
            const toggleButton = document.getElementById('toggleChatbot');
            const toggleIcon = document.getElementById('chatbotToggle');
            const messagesContainer = document.getElementById('chatbotMessages');
            const inputField = document.getElementById('chatbotInput');
            const sendButton = document.getElementById('sendMessage');
            const header = document.querySelector('.chatbot-header');

            // Make chatbot draggable
            let isDragging = false;
            let currentX = 0;
            let currentY = 0;
            let initialX = 0;
            let initialY = 0;
            let xOffset = 0;
            let yOffset = 0;

            header.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            function dragStart(e) {
                if (e.target === toggleButton) return; // Don't drag if clicking the toggle button
                
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                if (e.target === header || e.target.parentElement === header) {
                    isDragging = true;
                    chatbot.style.cursor = 'grabbing';
                }
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;

                    xOffset = currentX;
                    yOffset = currentY;

                    setTranslate(currentX, currentY, chatbot);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                chatbot.style.cursor = 'default';
            }

            function setTranslate(xPos, yPos, el) {
                el.style.transform = `translate(${xPos}px, ${yPos}px)`;
            }

            // Toggle chatbot visibility
            toggleButton.addEventListener('click', () => {
                if (chatbot.classList.contains('collapsed')) {
                    chatbot.classList.remove('collapsed');
                    toggleIcon.classList.add('hidden');
                } else {
                    chatbot.classList.add('collapsed');
                    toggleIcon.classList.remove('hidden');
                }
            });

            toggleIcon.addEventListener('click', () => {
                chatbot.classList.remove('collapsed');
                toggleIcon.classList.add('hidden');
            });

            // Add message to chat
            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = text;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            // Send message function
            async function sendMessage() {
                const message = inputField.value.trim();
                if (!message) return;

                addMessage(message, 'user');
                inputField.value = '';

                try {
                    const response = await getBotResponse(message);
                    addMessage(response, 'bot');
                } catch (error) {
                    console.error('Error processing message:', error);
                    addMessage("Sorry, I encountered an error. Please try again later.", 'bot');
                }
            }

            // Get bot response
            async function getBotResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Check for specific keywords and patterns
                if (lowerMessage.includes('project') && (lowerMessage.includes('details') || lowerMessage.includes('info'))) {
                    return await handleProjectDetails(message);
                } else if (lowerMessage.includes('collaborators') && lowerMessage.includes('project')) {
                    return await handleProjectCollaborators(message);
                } else if (lowerMessage.includes('hackathon') && (lowerMessage.includes('team') || lowerMessage.includes('members'))) {
                    return await handleHackathonTeam(message);
                } else if (lowerMessage.includes('profile') && lowerMessage.includes('collaborator')) {
                    return await handleCollaboratorProfile(message);
                } else if (lowerMessage.includes('profile') && lowerMessage.includes('owner')) {
                    return await handleOwnerProfile(message);
                } else if (lowerMessage.includes('my projects')) {
                    return await handleMyProjects();
                } else if (lowerMessage.includes('my teams')) {
                    return await handleMyTeams();
                } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                    return "Hello! How can I help you today?";
                } else if (lowerMessage.includes('help')) {
                    return "I can help you with:\n1. Viewing project details\n2. Checking project collaborators\n3. Managing hackathon teams\n4. Viewing team members\n5. Accessing collaborator profiles\n6. Accessing owner profiles\n7. Listing your projects\n8. Listing your teams\n\nWhat would you like to know?";
                } else {
                    return "I'm not sure I understand. I can help you with:\n1. Viewing project details\n2. Checking project collaborators\n3. Managing hackathon teams\n4. Viewing team members\n5. Accessing collaborator profiles\n6. Accessing owner profiles\n7. Listing your projects\n8. Listing your teams\n\nWhat would you like to know?";
                }
            }

            // Handle project details query
            async function handleProjectDetails(message) {
                try {
                    const projectTitle = message.match(/project\s+"([^"]+)"/i)?.[1] || 
                                       message.match(/project\s+([^"]+)/i)?.[1];
                    
                    if (!projectTitle) {
                        return "Please specify which project's details you want to view. Example: 'Show details for project \"My Project\"'";
                    }

                    const response = await fetch(`${API_URL}/users/projects`, {
                        credentials: 'include'
                    });
                    const projects = await response.json();
                    
                    const project = projects.find(p => 
                        p.title.toLowerCase().includes(projectTitle.toLowerCase())
                    );

                    if (!project) {
                        return `Project "${projectTitle}" not found in your projects.`;
                    }

                    const detailsResponse = await fetch(`${API_URL}/projects/${project._id}`, {
                        credentials: 'include'
                    });
                    const projectDetails = await detailsResponse.json();

                    let responseText = ` Project Details for "${projectDetails.title}":\n\n`;
                    responseText += ` Description:\n${projectDetails.description || 'No description available'}\n\n`;
                    responseText += ` Tech Stack:\n${projectDetails.techStack?.join(', ') || 'Not specified'}\n\n`;
                    responseText += ` Looking For:\n${projectDetails.lookingFor?.join(', ') || 'Not specified'}\n\n`;
                    if (projectDetails.githubLink) {
                        responseText += ` GitHub Link:\n${projectDetails.githubLink}\n\n`;
                    }
                    responseText += ` Created At: ${new Date(projectDetails.createdAt).toLocaleDateString()}\n`;
                    responseText += ` Last Updated: ${new Date(projectDetails.updatedAt).toLocaleDateString()}`;

                    return responseText;
                } catch (error) {
                    console.error('Error fetching project details:', error);
                    return "Sorry, I couldn't fetch the project details. Please try again later.";
                }
            }

            // Handle project collaborators query
            async function handleProjectCollaborators(message) {
                try {
                    const projectTitle = message.match(/project\s+"([^"]+)"/i)?.[1] || 
                                       message.match(/project\s+([^"]+)/i)?.[1];
                    
                    if (!projectTitle) {
                        return "Please specify which project you want to check collaborators for. Example: 'Show collaborators for project \"My Project\"'";
                    }

                    // First, try to find the project in user's projects
                    const userProjectsResponse = await fetch(`${API_URL}/users/projects`, {
                        credentials: 'include'
                    });
                    
                    if (!userProjectsResponse.ok) {
                        throw new Error('Failed to fetch user projects');
                    }
                    
                    const userProjects = await userProjectsResponse.json();
                    const project = userProjects.find(p => 
                        p.title.toLowerCase().includes(projectTitle.toLowerCase())
                    );

                    if (!project) {
                        // If not found in user's projects, try all projects
                        const allProjectsResponse = await fetch(`${API_URL}/projects`, {
                            credentials: 'include'
                        });
                        
                        if (!allProjectsResponse.ok) {
                            throw new Error('Failed to fetch all projects');
                        }
                        
                        const allProjects = await allProjectsResponse.json();
                        const foundProject = allProjects.find(p => 
                            p.title.toLowerCase().includes(projectTitle.toLowerCase())
                        );
                        
                        if (!foundProject) {
                            return `Project "${projectTitle}" not found.`;
                        }
                        
                        // Check if user is a collaborator or owner
                        const isCollaborator = foundProject.collaborators.some(c => c._id === currentUserId);
                        const isOwner = foundProject.owner._id === currentUserId;
                        
                        if (!isCollaborator && !isOwner) {
                            return `You don't have access to view collaborators for project "${projectTitle}".`;
                        }
                        
                        project = foundProject;
                    }

                    // Fetch detailed project info with populated collaborators
                    const projectDetailsResponse = await fetch(`${API_URL}/projects/${project._id}`, {
                        credentials: 'include'
                    });
                    
                    if (!projectDetailsResponse.ok) {
                        throw new Error('Failed to fetch project details');
                    }
                    
                    const projectDetails = await projectDetailsResponse.json();
                    
                    if (!projectDetails.collaborators || projectDetails.collaborators.length === 0) {
                        return `No collaborators found for project "${projectTitle}".`;
                    }

                    let responseText = ` Collaborators for "${projectTitle}":\n\n`;
                    
                    // Add owner information
                    responseText += ` Owner:\n`;
                    responseText += `   ${projectDetails.owner.name}\n`;
                    responseText += `   ${projectDetails.owner.email}\n\n`;
                    
                    // Add collaborators information
                    responseText += ` Collaborators:\n`;
                    projectDetails.collaborators.forEach((c, index) => {
                        responseText += `${index + 1}. ${c.name}\n`;
                        responseText += `    ${c.email}\n`;
                        if (c.role) responseText += `    Role: ${c.role}\n`;
                        if (c.skills?.length > 0) responseText += `    Skills: ${c.skills.join(', ')}\n`;
                        responseText += '\n';
                    });

                    return responseText;
                } catch (error) {
                    console.error('Error fetching project collaborators:', error);
                    return "Sorry, I couldn't fetch the project collaborators. Please try again later.";
                }
            }

            // Handle hackathon team query
            async function handleHackathonTeam(message) {
                try {
                    const teamName = message.match(/team\s+"([^"]+)"/i)?.[1] || 
                                   message.match(/team\s+([^"]+)/i)?.[1];
                    
                    if (!teamName) {
                        return "Please specify which team you want to check. Example: 'Show members for team \"My Team\"'";
                    }

                    const response = await fetch(`${API_URL}/hackathon-teams/teams-im-in`, {
                        credentials: 'include'
                    });
                    const teams = await response.json();
                    
                    const team = teams.find(t => 
                        t.teamName.toLowerCase().includes(teamName.toLowerCase())
                    );

                    if (!team) {
                        return `Team "${teamName}" not found in your teams.`;
                    }

                    let responseText = `Team Details for "${team.teamName}":\n\n`;
                    responseText += `Hackathon: ${team.hackathonName}\n\n`;
                    responseText += `Team Members:\n`;
                    team.teamMembers.forEach(m => {
                        responseText += `- ${m.user.name} (${m.position})\n`;
                        if (m.skills?.length > 0) responseText += `  Skills: ${m.skills.join(', ')}\n`;
                        responseText += '\n';
                    });

                    return responseText;
                } catch (error) {
                    console.error('Error fetching team details:', error);
                    return "Sorry, I couldn't fetch the team details. Please try again later.";
                }
            }

            // Handle collaborator profile query
            async function handleCollaboratorProfile(message) {
                try {
                    // Extract collaborator name from message
                    const collaboratorMatch = message.match(/show profile for collaborator ['"]([^'"]+)['"]/i);
                    if (!collaboratorMatch) {
                        return "Please specify the collaborator's name in the format: 'Show profile for collaborator \"Name\"'";
                    }
                    const collaboratorName = collaboratorMatch[1];

                    // First get all user's projects
                    const userProjectsResponse = await fetch(`${API_URL}/users/projects`, {
                        credentials: 'include'
                    });

                    if (!userProjectsResponse.ok) {
                        throw new Error('Failed to fetch user projects');
                    }

                    const userProjects = await userProjectsResponse.json();
                    
                    // Search for collaborator in all projects
                    let foundCollaborator = null;
                    let foundProject = null;

                    for (const project of userProjects) {
                        // Check project owner
                        if (project.owner && project.owner.name.toLowerCase().includes(collaboratorName.toLowerCase())) {
                            foundCollaborator = project.owner;
                            foundProject = project;
                            break;
                        }

                        // Check collaborators
                        if (project.collaborators) {
                            const collaborator = project.collaborators.find(
                                c => c.name.toLowerCase().includes(collaboratorName.toLowerCase())
                            );
                            if (collaborator) {
                                foundCollaborator = collaborator;
                                foundProject = project;
                                break;
                            }
                        }
                    }

                    if (!foundCollaborator) {
                        return `No collaborator named "${collaboratorName}" found in your projects.`;
                    }

                    // Fetch the full profile data from the API
                    const profileResponse = await fetch(`${API_URL}/users/${foundCollaborator._id}/profile`, {
                        credentials: 'include'
                    });

                    if (!profileResponse.ok) {
                        if (profileResponse.status === 403) {
                            return `You are not authorized to view ${foundCollaborator.name}'s profile. You need to be an authenticated user.`;
                        }
                        throw new Error('Failed to fetch collaborator profile');
                    }

                    const profile = await profileResponse.json();

                    // Format the response with detailed profile information
                    let response = ` Profile Details for ${profile.name}\n\n`;
                    response += ` Email:\n${profile.email || 'Not provided'}\n\n`;
                    response += ` Enrollment ID:\n${profile.enrollmentId || 'Not provided'}\n\n`;
                    response += ` Phone:\n${profile.phoneNumber || 'Not provided'}\n\n`;

                    if (profile.techStack && profile.techStack.length > 0) {
                        response += ` Tech Stack:\n`;
                        profile.techStack.forEach(tech => {
                            response += `   ${tech}\n`;
                        });
                        response += '\n';
                    }

                    // Add projects information
                    if (profile.projects && profile.projects.length > 0) {
                        response += ` Projects (${profile.projects.length}):\n`;
                        profile.projects.forEach(project => {
                            response += `   ${project.title}\n`;
                        });
                        response += '\n';
                    }

                    // Add collaborations information
                    if (profile.collaborations && profile.collaborations.length > 0) {
                        response += ` Collaborations (${profile.collaborations.length}):\n`;
                        profile.collaborations.forEach(project => {
                            response += `   ${project.title}\n`;
                        });
                        response += '\n';
                    }

                    response += ` Found in project:\n"${foundProject.title}"`;

                    return response;
                } catch (error) {
                    console.error('Error fetching collaborator profile:', error);
                    return `Sorry, I couldn't fetch the collaborator's profile: ${error.message}`;
                }
            }

            // Handle owner profile query
            async function handleOwnerProfile(message) {
                try {
                    // Extract owner name from message
                    const ownerMatch = message.match(/show profile for owner ['"]([^'"]+)['"]/i);
                    if (!ownerMatch) {
                        return "Please specify the owner's name in the format: 'Show profile for owner \"Name\"'";
                    }
                    const ownerName = ownerMatch[1];

                    // Get all collaborated projects
                    const collaborationsResponse = await fetch(`${API_URL}/users/collaborations`, {
                        credentials: 'include'
                    });

                    if (!collaborationsResponse.ok) {
                        throw new Error('Failed to fetch collaborated projects');
                    }

                    const collaboratedProjects = await collaborationsResponse.json();
                    
                    // Search for owner in collaborated projects
                    let foundOwner = null;
                    let foundProject = null;

                    for (const project of collaboratedProjects) {
                        if (project.owner && project.owner.name.toLowerCase().includes(ownerName.toLowerCase())) {
                            foundOwner = project.owner;
                            foundProject = project;
                            break;
                        }
                    }

                    if (!foundOwner) {
                        return `No owner named "${ownerName}" found in your collaborated projects.`;
                    }

                    // Fetch the full profile data from the API
                    const profileResponse = await fetch(`${API_URL}/users/${foundOwner._id}/profile`, {
                        credentials: 'include'
                    });

                    if (!profileResponse.ok) {
                        if (profileResponse.status === 403) {
                            return `You are not authorized to view ${foundOwner.name}'s profile. You need to be an authenticated user.`;
                        }
                        throw new Error('Failed to fetch owner profile');
                    }

                    const profile = await profileResponse.json();

                    // Format the response with detailed profile information
                    let response = ` Profile Details for ${profile.name}\n\n`;
                    response += ` Email:\n${profile.email || 'Not provided'}\n\n`;
                    response += ` Enrollment ID:\n${profile.enrollmentId || 'Not provided'}\n\n`;
                    response += ` Phone:\n${profile.phoneNumber || 'Not provided'}\n\n`;

                    if (profile.techStack && profile.techStack.length > 0) {
                        response += ` Tech Stack:\n`;
                        profile.techStack.forEach(tech => {
                            response += `   ${tech}\n`;
                        });
                        response += '\n';
                    }

                    // Add projects information
                    if (profile.projects && profile.projects.length > 0) {
                        response += ` Projects (${profile.projects.length}):\n`;
                        profile.projects.forEach(project => {
                            response += `   ${project.title}\n`;
                        });
                        response += '\n';
                    }

                    // Add collaborations information
                    if (profile.collaborations && profile.collaborations.length > 0) {
                        response += ` Collaborations (${profile.collaborations.length}):\n`;
                        profile.collaborations.forEach(project => {
                            response += `   ${project.title}\n`;
                        });
                        response += '\n';
                    }

                    response += ` Found in project:\n"${foundProject.title}"`;

                    return response;
                } catch (error) {
                    console.error('Error fetching owner profile:', error);
                    return `Sorry, I couldn't fetch the owner's profile: ${error.message}`;
                }
            }

            // Handle my projects query
            async function handleMyProjects() {
                try {
                    const response = await fetch(`${API_URL}/users/projects`, {
                        credentials: 'include'
                    });
                    const projects = await response.json();
                    
                    if (!projects || projects.length === 0) {
                        return "You don't have any projects listed.";
                    }

                    let responseText = " Your Projects:\n\n";
                    projects.forEach((project, index) => {
                        responseText += `Project ${index + 1}:\n`;
                        responseText += ` Title: ${project.title}\n`;
                        responseText += ` Description: ${project.description || 'No description'}\n`;
                        responseText += ` Tech Stack: ${project.techStack?.join(', ') || 'Not specified'}\n`;
                        responseText += ` Looking For: ${project.lookingFor?.join(', ') || 'Not specified'}\n\n`;
                    });

                    return responseText;
                } catch (error) {
                    console.error('Error fetching projects:', error);
                    return "Sorry, I couldn't fetch your projects. Please try again later.";
                }
            }

            // Handle my teams query
            async function handleMyTeams() {
                try {
                    const response = await fetch(`${API_URL}/hackathon-teams/teams-im-in`, {
                        credentials: 'include'
                    });
                    const teams = await response.json();
                    
                    if (!teams || teams.length === 0) {
                        return "You're not part of any hackathon teams.";
                    }

                    let responseText = " Your Teams:\n\n";
                    teams.forEach((team, index) => {
                        responseText += `Team ${index + 1}:\n`;
                        responseText += ` Name: ${team.teamName}\n`;
                        responseText += ` Hackathon: ${team.hackathonName}\n`;
                        responseText += ` Team Size: ${team.currentSize}/${team.teamSize}\n`;
                        responseText += ` Your Role: ${team.teamMembers.find(m => m.user._id === currentUserId)?.position || 'Not specified'}\n\n`;
                    });

                    return responseText;
                } catch (error) {
                    console.error('Error fetching teams:', error);
                    return "Sorry, I couldn't fetch your teams. Please try again later.";
                }
            }

            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            inputField.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
    </script>
</body>
</html> 